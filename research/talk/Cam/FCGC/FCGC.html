<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<title>Fast Conservative GC</title>
<meta name="author" content="Zaz Brown"/>
<meta name="description" content=""/>
<meta name="keywords" content=""/>
<style type="text/css">
.underline { text-decoration: underline; }
</style>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/reveal.js/dist/reveal.css"/>

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/reveal.js/dist/theme/serif.css" id="theme"/>

</head>
<body>
<div class="reveal">
<div class="slides">
<section id="sec-title-slide"><h1 class="title">Fast Conservative GC</h1><p class="subtitle"></p>
<h2 class="author">Zaz Brown</h2>
</section>
<section id="sec-table-of-contents"><div id="table-of-contents" role="doc-toc">
<h2>Table of Contents</h2>
<div id="text-table-of-contents" role="doc-toc">
<ul>
<li><a href="#/slide-org93ad26b">Exact vs Conservative</a></li>
<li><a href="#/slide-orge61408e">Exact GC Disadvantages</a></li>
<li><a href="#/slide-orgfb960f0">Conservative GC Disadvantages</a></li>
<li><a href="#/slide-orgf35eb6a">Immix Advantage</a></li>
<li><a href="#/slide-org3d8614c">Performance Robustness</a></li>
<li><a href="#/slide-orgb75c66c"><span style="display:inline-block">Why not use</span> <span style="display:inline-block">conservative GC?</span></a></li>
<li><a href="#/slide-org23bb983">Questions?</a></li>
<li><a href="#/slide-orga092515">References</a></li>
</ul>
</div>
</div>
</section>
<p>
<style>.reveal .slide-number {
  font-size: 24pt;
  top: 8px;
  left: 8px;
  right: auto;
  bottom: auto;
  color: inherit;
  background-color: transparent;
}
.reveal .slide-number .slide-number-delimiter {
  margin: 0 -0.5rem;
}</style> 
</p>
<section>
<section id="slide-org93ad26b" data-transition="fade">
<h2 id="org93ad26b">Exact vs Conservative</h2>
<p>
recognizes   vs   guesses pointers                 
</p>

<aside class="notes">
<p>
goal of GC: determine objects that won&rsquo;t be used again - undecidable
</p>

<p>
exact GC: underapprox by cleaning unreachable objects
</p>

<p>
conservative: more underapprox
</p>

</aside>
</section>
</section>
<section>
<section id="slide-orge61408e">
<h2 id="orge61408e">Exact GC Disadvantages</h2>
<p>
difficult to implement
</p>

<p>
prevents code motion
</p>

<aside class="notes">
<p>
like type systems; hard
</p>

<p>
exact GC requires stack maps; difficult engineering
</p>

<p>
compiler opt. such as code motion
</p>

</aside>
</section>
</section>
<section>
<section id="slide-orgfb960f0">
<h2 id="orgfb960f0">Conservative GC Disadvantages</h2>
<p>
guesses pointers
</p>

<ul>
<li>int could be ptr: excess retention  <span class="fragment" data-fragment-index="0">  0.01%</span></li>

<li>ptr could be int: pin referent  <span class="fragment" data-fragment-index="0">  0.03%</span></li>

</ul>

<aside class="notes">
<p>
no surprise that these restrictions slow things down
</p>

<p>
BUT actually this paper shows only 0.01% &amp; 0.03%
</p>

<p>
so what is slowing things down??
</p>

</aside>
</section>
<section id="slide-org29d13fc" data-transition="fade">
<h3 id="org29d13fc"><i>was</i> slow</h3>

<div id="org5ee30b7" class="figure">
<p><img src="./img/performance vs Gen Immix without RC Immix.svg" alt="performance vs Gen Immix without RC Immix.svg" class="org-svg" width="100%" />
</p>
</div>
<aside class="notes">
<p>
exact semi-space
</p>

<p>
conservative mostly-copying collection
</p>

<p>
exact mark &amp; sweep
</p>

<p>
conservative Boehm, Demers, Weiser
</p>

<p>
12% slowdown - showstopper
</p>

</aside>
</section>
<section id="slide-org1dd19a8" data-transition="fade">
<h3 id="org1dd19a8"><i>was</i> slow</h3>

<div id="org8cec8a6" class="figure">
<p><img src="./img/performance vs Gen Immix without RC Immix_cons.svg" alt="performance vs Gen Immix without RC Immix_cons.svg" class="org-svg" width="100%" />
</p>
</div>
</section>
<section id="slide-orgc08ccdf" data-transition="fade">
<h3 id="orgc08ccdf"><i>now</i> fast</h3>

<div id="orgc3cf5c5" class="figure">
<p><img src="./img/performance vs Gen Immix.svg" alt="performance vs Gen Immix.svg" class="org-svg" width="100%" />
</p>
</div>

<aside class="notes">
<p>
why is building a conservative GC on Immix so fast?? &#x2026;
</p>

</aside>
</section>
</section>
<section>
<section id="slide-orgf35eb6a">
<h2 id="orgf35eb6a">Immix Advantage</h2>
<p>
MCC pins 4 KiB pages, BDW uses free-list
</p>

<p>
Immix pins 256B lines, uses bump pointer
</p>

<p>
improves fragmentation &amp; mutator locality
</p>
<aside class="notes">
<p>
<i>this</i> is what leads to performance advantage: heap organization
</p>

<p>
<b>not</b> excess retention and pinning
</p>

<p>
how did they build RC Immix<sub>cons</sub>? &#x2026;
</p>

</aside>
</section>
<section id="slide-org9f2bfec">
<h3 id="org9f2bfec">RC Immix</h3>

<div id="org18f0ea6" class="figure">
<p><img src="./img/header bits.svg" alt="header bits.svg" class="org-svg" />
</p>
</div>

<p>
Immix + live object count
</p>

<p>
combines tracing &amp; counting
</p>

<aside class="notes">
<p>
figure from Rifat&rsquo;s PhD thesis
</p>

<p>
behaves like tracing collector for young obj
</p>

<p>
behaves like a ref counting collector for mature obj
</p>

<p>
as Michael mentions: no strict delineation, highly optimized GCs combine both
</p>

</aside>
</section>
<section id="slide-org388026e">
<h3 id="org388026e">RC Immix<sub>cons</sub> filtering</h3>
<p>
bitmap to determine valid objects
</p>
<ul>
<li>collector clears bit for dead object</li>
<li>ambiguous references are checked against bitmap</li>

</ul>

<p>
 
</p>

<p>
10× reduction in pinned objects vs MCC
</p>

<aside class="notes">
<p>
because of the granularity of Immix:
</p>

<p>
MCC pinned obj / live: 2%
</p>

<p>
Immix pinned obj / live: 0.2%
</p>

</aside>
</section>
</section>
<section>
<section id="slide-org3d8614c">
<h2 id="org3d8614c">Performance Robustness</h2>

<div id="orgfea459b" class="figure">
<p><img src="./img/performance vs Gen Immix.svg" alt="performance vs Gen Immix.svg" class="org-svg" width="100%" />
</p>
</div>

<aside class="notes">
<p>
&#x2026; but under what assumptions?
</p>

<p>
how well does performance generalize?
</p>

</aside>
</section>
<section id="slide-orgdd3c2cc">
<h3 id="orgdd3c2cc">Java</h3>
<p>
Jikes RVM &amp; MMTk
</p>

<p>
<b>simulated:</b>
</p>

<ul>
<li>poor code quality by disabling optimizations</li>
<li>immature VM by deoptimising runtime code</li>

</ul>
<aside class="notes">
<p>
should give an idea how it would work for other languages
</p>

<p>
seems to work well
</p>

<p>
RC Immix<sub>cons</sub> ≈ Immix<sub>cons</sub>
</p>

<p>
⇒ RC mature objects not helpful until VM and code quality are well-optimized
</p>

</aside>
</section>
<section id="slide-orga873ded">
<h3 id="orga873ded">Time vs Heap Size</h3>

<div id="org0418e4a" class="figure">
<p><img src="./img/total time vs heap size.svg" alt="total time vs heap size.svg" class="org-svg" width="100%" />
</p>
</div>
<aside class="notes">
<p>
at very small heap sizes, slight Gen Immix advantage vs RC Immix<sub>cons</sub>
</p>

</aside>
</section>
<section id="slide-org8bb8358">
<h3 id="org8bb8358">Increased Pinning</h3>

<div id="org75c7f6d" class="figure">
<p><img src="./img/increased pinning.svg" alt="increased pinning.svg" class="org-svg" width="100%" />
</p>
</div>

<aside class="notes">
<p>
artificially increased number of pinned objects
</p>

<p>
32× pinning ⇒ 11% performance hit
</p>

</aside>
</section>
</section>
<section>
<section id="slide-orgb75c66c">
<h2 id="orgb75c66c"><span style="display:inline-block">Why not use</span> <span style="display:inline-block">conservative GC?</span></h2>
<aside class="notes">
<p>
That concludes my presentation
</p>

<p>
Why not conservative GC?
</p>
<ul>
<li>exact GC already underapprox</li>
<li>conservative tiny bit more underapprox</li>
<li>conservative as performant as exact GC</li>

<li>can&rsquo;t handle pointer arithmetic (e.g. XOR linked lists don&rsquo;t appear to be pointers)</li>
<li>worst case could be really bad (DoS attack potential?)</li>

<li>minimum heap size is slightly larger</li>

</ul>

</aside>
</section>
</section>
<section>
<section id="slide-org23bb983">
<h2 id="org23bb983">Questions?</h2>
<p>
<a href="https://zazbrown.com/research/talk/Cam/FCGC/FCGC.html">zazbrown.com/research/talk</a>
</p>
</section>
</section>
<section>
<section id="slide-orga092515">
<h2 id="orga092515">References</h2>
<p>
<a href="https://doi.org/10.1145/2714064.2660198">Fast Conservative Garbage Collection, 2014</a>
</p>

<p>
<a href="https://rifatshahriyar.github.io/files/others/Thesis_Rifat_Shahriyar.pdf">High Performance Reference Counting and Conservative Garbage Collection, 2015</a> - PhD thesis
</p>
</section>
</section>
</div>
</div>
<script src="https://cdn.jsdelivr.net/npm/reveal.js/dist/reveal.js"></script>
<script src="https://cdn.jsdelivr.net/npm/reveal.js/plugin/markdown/markdown.js"></script>
<script src="https://cdn.jsdelivr.net/npm/reveal.js/plugin/zoom/zoom.js"></script>
<script src="https://cdn.jsdelivr.net/npm/reveal.js/plugin/notes/notes.js"></script>


<script>
// Full list of configuration options available here:
// https://github.com/hakimel/reveal.js#configuration
Reveal.initialize({
plugins: [RevealMarkdown, RevealZoom, RevealNotes],
slideNumber:true
});

</script>
</body>
</html>
